<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- TODO: for stability would useful to include all the links from static files locally -->
    <script src="https://cdn.jsdelivr.net/npm/sorttable@1.0.2"></script>
    <title>{{ title }}</title>
    {{ md_css }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"
        integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ=="
        crossorigin="" />
</head>

<body>
    <div id="logo-div">
        <img id="dtu-logo" src="data:image/png;base64,{{logos[0]}}">
        <img id="windsider-logo" src="data:image/png;base64,{{logos[1]}}">
    </div>

    <div id="parent" class="js-toc-content">

        <div id="sidebar">
            <h3>Table of Contents</h3>
            <div class="js-toc"></div>
            <br>
        </div>
        <div id="main-content">
            <h1 class="center">{{ title }}</h1>

            <p>
                The {{ obs }} vs {{ mod }} validation was produced on {{ meta.date.date().isoformat() }} at {{
                meta.date.time().isoformat(timespec="seconds") }} {% if meta.user != "" %} by {{ meta.user }} {% endif
                %} using wind-validation version: {{ meta.version }}. This report provides insight into single point validation results.
            </p>

            <h2 id='h-2' slot='h-2'>Site location</h2>
            <div id='map'></div>

            <h2 id='h-4' slot='h-4'>Detailed validation</h2>

            {{ table }}

            <h2 id='h-5' slot='h-5'>References</h2>
            DTU Wind Energy, Wind-validation, (2021), GitLab repository,
            <a
                href="https://gitlab.windenergy.dtu.dk/windsider/wind-validation/">https://gitlab.windenergy.dtu.dk/windsider/wind-validation/</a>

        </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
    <script>
        tocbot.init({
            // Where to render the table of contents.
            tocSelector: '.js-toc',
            // Where to grab the headings to build the table of contents.
            contentSelector: '.js-toc-content',
            // Which headings to grab inside of the contentSelector element.
            headingSelector: 'h2',
            // For headings inside relative or absolute positioned containers within content.
            hasInnerContainers: true,
        });
    </script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"
        integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg=="
        crossorigin=""></script>
    <script type='text/javascript'
        src='https://leaflet.github.io/Leaflet.markercluster/dist/leaflet.markercluster-src.js'></script>
    <script type='text/javascript'>
        var tiles = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 17,
            attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
        });
        latlng = new L.LatLng(50, 5);
        var map = new L.Map('map', {
            center: latlng,
            zoom: 2,
            layers: [tiles]
        });
        var markeroptions = {
            color: '#ff9933',
            fillColor: '#ff9933',
            fillOpacity: 1,
            opacity: 0,
            weight: 12,
            radius: 6
        };

        markers = [
            {% for index, st in iterrow %}
        ['{{ index }}', {{ st.south_north }}, {{ st.west_east }}, {{ st.height }}, {{ st.power_density_mpe | round(1) }}],
            {% endfor %}
        ];

        var markers2 = new L.markerClusterGroup({
            singleMarkerMode: true,
            chunkedLoading: true
        });

        function populate() {
            for (var i = 0; i < markers.length; ++i) {
                var text = '<p>Position: ' + markers[i][1].toFixed(3) + 'N, ' + + markers[i][2].toFixed(3) + 'S, ' + markers[i][3] + ' m agl</p><p>Mean Power Density Error: ' + markers[i][4] + ' (%)</p>';
                markers2.addLayer(new L.circleMarker([markers[i][1], markers[i][2]], markeroptions).bindPopup('<h4>' + markers[i][0] + '</h4>' + text));
            }
            return false;
        }
        map.addLayer(markers2);

        marker = markers[0];
        lat = marker[1];
        lng = marker[2];
        zoom = 15;
        map.setView([lat, lng], zoom);

        populate();
    </script>
</body>

</html>
