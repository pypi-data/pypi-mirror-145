/// Files: net/nfc/nci/rsp.c
/// Fix: 1b1499a817c90fd1ce9453a2c98d2a01cca0e775
/// Detect-To: 15d4a8da0e440faf589a26346c8287e1ed0abe6c

virtual detect

@err exists@
identifier conn_info, ndev;
position p;
@@

nci_core_conn_close_rsp_packet(struct nci_dev *ndev, ...)
{
	...
*	conn_info = nci_get_conn_info_by_conn_id(ndev,
*						 ndev->cur_conn_id);
	if (conn_info) {
*		list_del@p(&conn_info->list);
		... when != if (conn_info == ndev->rf_conn_info) ndev->rf_conn_info = NULL;
*		devm_kfree(&ndev->nfc_dev->dev, conn_info);
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-3760')
